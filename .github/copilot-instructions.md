<!-- Copilot instructions for contributors and AI coding agents -->

# Project snapshot for AI coding agents

This file contains concise, actionable guidance to help an AI coding agent be productive in this repository.

## Big picture

- Monorepo-style layout with a small mock API and a Vite + React frontend.
- `api/` — Express-based mock API (runs with `npx vite-node api/server.ts`) that reads static mock data from `api/data.ts` and also includes server-side Supabase clients in `api/supabase.ts`.
- `src/` — React app using TypeScript, TanStack Router (file-based routes under `src/routes`), and React Query. `src/main.tsx` wires `routeTree.gen.ts` (generated) and providers.
- Supabase is used as the primary persistent store; see `src/lib/supabase.ts` (client/anon key used by frontend) and `api/supabase.ts` (server, prefers service role key).

## Run / debug (essential commands)

- Install deps: `npm install`
- Run both frontend and mock API (dev): `npm start` (runs `start:api` and `start:client`).
- Run only backend mock API: `npm run start:api` (uses `npx vite-node api/server.ts`).
- Run only frontend: `npm run start:client` (Vite dev server).
- Migrations / data import: See `SUPABASE_MIGRATION.md` — run `npx vite-node api/migrate-to-supabase.ts` after setting `SUPABASE_URL` and `SUPABASE_SERVICE_ROLE_KEY`.

## Environment & secrets

- Local dev defaults exist in `src/lib/supabase.ts` (fallback anon key + localhost URL). For real DB operations set environment variables:
  - `SUPABASE_URL`
  - `SUPABASE_ANON_KEY` (frontend)
  - `SUPABASE_SERVICE_ROLE_KEY` (server / migrations) — do NOT commit this key.

## Project-specific patterns & gotchas

- Generated routes: `src/routeTree.gen.ts` is autogenerated by TanStack Router — DO NOT EDIT. Modify route files under `src/routes/*` and let the generator update the file.
- Two Supabase clients:
  - `api/supabase.ts` — server-side client (service role preferred).
  - `src/lib/supabase.ts` — frontend client (Vite env vars via `import.meta.env`).
- Mock vs production data:
  - `api/data.ts` contains the authoritative mock dataset used by the Express mock API.
  - `src/api/*` contains client-side wrappers; note `src/api/rooms.ts` currently returns a stubbed response early (intentional local mock) — search for early returns when debugging data mismatches.
- Pagination and sizes commonly use `SIZE = 50` (both backend and frontend wrappers) — keep consistent if changing pagination behavior.

## Files to inspect for common tasks (examples)

- API behavior & routes: [api/server.ts](api/server.ts)
- Mock dataset: [api/data.ts](api/data.ts)
- Supabase server client: [api/supabase.ts](api/supabase.ts)
- Frontend Supabase client: [src/lib/supabase.ts](src/lib/supabase.ts)
- Frontend entry: [src/main.tsx](src/main.tsx)
- Generated routes: [src/routeTree.gen.ts](src/routeTree.gen.ts)
- Frontend API wrappers: [src/api/rooms.ts](src/api/rooms.ts)
- Migrations: [supabase/migrations/20251221222227_create_rooms_table.sql](supabase/migrations/20251221222227_create_rooms_table.sql)
- Migration guide: [SUPABASE_MIGRATION.md](SUPABASE_MIGRATION.md)

## Typical code edits and where to do them

- Add a new UI page: create a file in `src/routes/` and update the route export; do NOT edit `routeTree.gen.ts` directly.
- Add a backend route or change API behavior: edit `api/server.ts` or add new files under `api/` and ensure `npm run start:api` picks them up.
- Change data shape / DB schema: update SQL under `supabase/migrations/` and run the migration steps in `SUPABASE_MIGRATION.md`.

## Testing and validation notes

- There are no automated test scripts in `package.json`. Use the dev servers and the Supabase migration script to validate behavior.
- When updating data-related code, cross-check: `api/data.ts` (mock), `api/server.ts` (mock server behavior), `src/api/*` (frontend wrappers), and `supabase/migrations/*` (schema).

## When to ask for clarification

- If the change requires production Supabase credentials or modifying migrations, request the `SUPABASE_SERVICE_ROLE_KEY` and a target DB URL or a dev project to avoid accidental production writes.

---

If anything here is unclear or you want additional examples (typical PRs, debugging steps, or VS Code launch configs for `vite-node`), tell me which area to expand.
